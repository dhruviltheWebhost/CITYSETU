<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CitySetu ‚Äì Your City, Your Services, One Setu</title>
    <link rel="icon" href="logo.jpg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <style>
        :root {
            --brand-navy: #1B2A49;
            --brand-orange: #FF7B00;
            --brand-gold: #ffc400;
            --font-main: 'Poppins', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: #f7fafc;
            color: #1a202c;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main#app-root {
            flex-grow: 1;
        }

        .hero-gradient {
            background: linear-gradient(135deg, var(--brand-navy), #1e40af);
        }

        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px -3px rgba(27, 42, 73, 0.2);
            border-color: var(--brand-orange);
        }

        .btn-animated {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn-orange {
            background-image: linear-gradient(to right, var(--brand-orange) 0%, var(--brand-gold) 100%);
            background-size: 200% auto;
        }

        .btn-orange:hover {
            background-position: right center;
        }

        /* Modal & Chat Visibility */
        #chat-window {
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
        }

        #chat-window.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .fade-in-section {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        header.header-scrolled {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="antialiased">

    <header id="main-header" class="bg-white sticky top-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-2 flex justify-between items-center">
            <a href="#" onclick="app.navigateTo('home')" class="flex items-center">
                <img src="logo.jpg" alt="Logo" class="h-12 w-auto mr-2" onerror="this.style.display='none'">
                <span class="text-2xl font-bold" style="color: var(--brand-navy);">CitySetu</span>
            </a>
            <div class="hidden md:flex items-center space-x-8 text-gray-600">
                <a href="#home" onclick="app.navigateTo('home')" class="hover:text-orange-500">Home</a>
                <a href="#services" class="hover:text-orange-500">Services</a>
                <a href="#join-us" class="hover:text-orange-500">Join Us</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-gray-600">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </nav>
        <div id="mobile-menu" class="md:hidden bg-white border-t hidden">
            <a href="#home" onclick="app.navigateTo('home')" class="block py-3 px-6 hover:bg-gray-50">Home</a>
            <a href="#join-us" class="block py-3 px-6 hover:bg-gray-50">Join Us</a>
        </div>
    </header>

    <main id="app-root">
        </main>

    <section id="join-us" class="py-20 bg-gray-100 fade-in-section">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold" style="color: var(--brand-navy);">Join Our Team of Experts</h2>
                <p class="text-gray-600 mt-2">Get verified leads in Ahmedabad.</p>
            </div>
            <form id="worker-signup-form" class="max-w-xl mx-auto bg-white p-8 rounded-lg shadow-md">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input type="text" id="signup-name" placeholder="Full Name" class="border p-2 rounded w-full" required>
                    <input type="tel" id="signup-phone" placeholder="Mobile Number" class="border p-2 rounded w-full" required pattern="[0-9]{10}">
                    <select id="signup-service" class="border p-2 rounded w-full" required>
                        <option value="" disabled selected>Select Service</option>
                        <option value="AC Repair">AC Repair</option>
                        <option value="Laptop Repair">Laptop Repair</option>
                        <option value="Electrician">Electrician</option>
                    </select>
                    <input type="text" id="signup-location" placeholder="Your Area" class="border p-2 rounded w-full" required>
                </div>
                <button type="submit" class="w-full btn-orange text-white font-bold py-3 rounded-full">Request to Join</button>
            </form>
        </div>
    </section>

    <footer class="bg-gray-800 text-white py-12 text-center">
        <h3 class="text-2xl font-bold">CitySetu</h3>
        <p class="text-gray-400 mt-2">¬© 2025 CitySetu. All rights reserved.</p>
    </footer>

    <div id="citysetu-chat-widget">
        <div id="chat-bubble" class="fixed bottom-6 right-6 w-14 h-14 bg-orange-500 rounded-full flex items-center justify-center shadow-lg cursor-pointer z-50">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" viewBox="0 0 256 256"><path d="M216,48H40A16,16,0,0,0,24,64V224L64,192H216a16,16,0,0,0,16-16V64A16,16,0,0,0,216,48Z"></path></svg>
        </div>
        <div id="chat-window" class="fixed bottom-24 right-6 w-80 h-96 bg-white rounded-xl shadow-2xl z-50 flex flex-direction-column overflow-hidden border">
            <div class="bg-slate-900 text-white p-4 flex justify-between items-center">
                <span>CitySetu Support</span>
                <button id="chat-close" class="text-xl">&times;</button>
            </div>
            <div class="p-4 flex-grow overflow-y-auto text-sm">
                <div class="bg-gray-100 p-2 rounded mb-2">Hello! How can we help you today?</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://citysetu-api.onrender.com';

        const app = {
            workerData: {},
            isLoading: false,

            elements: {
                root: document.getElementById('app-root'),
                header: document.getElementById('main-header'),
                mobileBtn: document.getElementById('mobile-menu-button'),
                mobileMenu: document.getElementById('mobile-menu')
            },

            async init() {
                // Event Listeners
                this.elements.mobileBtn.onclick = () => this.elements.mobileMenu.classList.toggle('hidden');
                window.onhashchange = () => this.router();
                window.onscroll = () => this.handleScroll();
                
                document.getElementById('worker-signup-form').onsubmit = (e) => {
                    e.preventDefault();
                    alert("Application submitted successfully! We will contact you soon.");
                };

                // Load Data and Initialize UI
                await this.loadWorkerData();
                this.router();
                this.initChat();
            },

            async loadWorkerData() {
                this.isLoading = true;
                this.renderLoading();
                try {
                    const res = await fetch(`${API_BASE_URL}/api/professionals/all`);
                    const json = await res.json();
                    const workers = json.workers || [];
                    
                    // Group workers by service
                    const grouped = {};
                    workers.forEach(w => {
                        const service = w.service || 'General';
                        if (!grouped[service]) grouped[service] = [];
                        grouped[service].push(w);
                    });
                    this.workerData = grouped;
                } catch (err) {
                    console.error("Data fetch error:", err);
                } finally {
                    this.isLoading = false;
                }
            },

            router() {
                const hash = window.location.hash.replace('#', '') || 'home';
                if (hash.startsWith('service/')) {
                    const serviceName = decodeURIComponent(hash.split('/')[1]);
                    this.renderServicePage(serviceName);
                } else {
                    this.renderHomePage();
                }
                window.scrollTo(0, 0);
            },

            navigateTo(page, param = '') {
                window.location.hash = param ? `${page}/${encodeURIComponent(param)}` : page;
            },

            renderLoading() {
                this.elements.root.innerHTML = `<div class="py-20 text-center text-gray-500">Loading services...</div>`;
            },

            renderHomePage() {
                const servicesHtml = Object.keys(this.workerData).map(service => `
                    <div class="card bg-white p-8 rounded-xl shadow-sm cursor-pointer border-b-4 border-orange-400" 
                         onclick="app.navigateTo('service', '${service}')">
                        <h3 class="text-xl font-bold text-slate-800">${service}</h3>
                        <p class="text-orange-500 font-medium mt-2">${this.workerData[service].length} Experts Available</p>
                    </div>
                `).join('');

                this.elements.root.innerHTML = `
                    <section class="hero-gradient text-white py-24 px-6 text-center">
                        <h1 class="text-4xl md:text-6xl font-bold">Your City, Your Services, One Setu</h1>
                        <p class="mt-4 text-blue-100 text-lg">Ahmedabad's most trusted professional network.</p>
                    </section>
                    <section id="services" class="py-16 container mx-auto px-6">
                        <h2 class="text-3xl font-bold mb-10 text-center">Popular Services</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            ${servicesHtml || '<p class="col-span-3 text-center">Connecting to server...</p>'}
                        </div>
                    </section>
                `;
                this.observeAnimations();
            },

            renderServicePage(service) {
                const workers = this.workerData[service] || [];
                const workersHtml = workers.map(w => `
                    <div class="bg-white p-6 rounded-lg shadow flex justify-between items-center border">
                        <div>
                            <h4 class="font-bold text-lg">üë®‚Äçüîß ${w.name}</h4>
                            <p class="text-gray-500 text-sm">${w.city || 'Ahmedabad'}</p>
                        </div>
                        <button class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm">Book Now</button>
                    </div>
                `).join('');

                this.elements.root.innerHTML = `
                    <div class="bg-slate-50 min-h-screen py-12 px-6">
                        <div class="container mx-auto max-w-4xl">
                            <button onclick="app.navigateTo('home')" class="mb-6 text-blue-600 font-medium flex items-center">
                                ‚Üê Back to All Services
                            </button>
                            <h2 class="text-3xl font-bold mb-8">${service} Experts</h2>
                            <div class="grid gap-4">
                                ${workersHtml || '<p>No experts found for this service.</p>'}
                            </div>
                        </div>
                    </div>
                `;
            },

            handleScroll() {
                if (window.scrollY > 50) this.elements.header.classList.add('header-scrolled');
                else this.elements.header.classList.remove('header-scrolled');
            },

            observeAnimations() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('is-visible') });
                }, { threshold: 0.1 });
                document.querySelectorAll('.fade-in-section').forEach(s => observer.observe(s));
            },

            initChat() {
                const bubble = document.getElementById('chat-bubble');
                const win = document.getElementById('chat-window');
                const close = document.getElementById('chat-close');
                
                bubble.onclick = () => win.classList.toggle('active');
                close.onclick = () => win.classList.remove('active');
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">

<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>CitySetu - Admin Dashboard</title>
ย ย <script src="https://cdn.tailwindcss.com"></script>
ย ย <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
ย ย <style>
ย ย ย ย :root {
ย ย ย ย ย ย --brand-navy: #1B2A49;
ย ย ย ย ย ย --brand-orange: #FF7B00;
ย ย ย ย }

ย ย ย ย body {
ย ย ย ย ย ย font-family: 'Poppins', sans-serif;
ย ย ย ย ย ย background-color: #f4f7f6;
ย ย ย ย }

ย ย ย ย .tab-btn {
ย ย ย ย ย ย padding: 1rem 1.5rem;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย color: #6b7280;
ย ย ย ย ย ย border-bottom: 3px solid transparent;
ย ย ย ย ย ย transition: all 0.3s ease;
ย ย ย ย }

ย ย ย ย .tab-btn.active {
ย ย ย ย ย ย color: var(--brand-navy);
ย ย ย ย ย ย border-bottom-color: var(--brand-orange);
ย ย ย ย }

ย ย ย ย .table-wrapper,
ย ย ย ย .section-wrapper {
ย ย ย ย ย ย display: none;
ย ย ย ย }

ย ย ย ย .table-wrapper.active,
ย ย ย ย .section-wrapper.active {
ย ย ย ย ย ย display: block;
ย ย ย ย }

ย ย ย ย /* Status Badges */
ย ย ย ย .status-badge {
ย ย ย ย ย ย padding: 0.25rem 0.75rem;
ย ย ย ย ย ย border-radius: 9999px;
ย ย ย ย ย ย font-size: 0.8rem;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย text-transform: uppercase;
ย ย ย ย }

ย ย ย ย .status-pending {
ย ย ย ย ย ย background-color: #fffbeb;
ย ย ย ย ย ย color: #d97706;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* This matches the 'Pending Review' status from the signups table */
ย ย ย ย .status-Pending,
ย ย ย ย .status-Pending-Review {
ย ย ย ย ย ย ยbackground-color: #fffbeb;
ย ย ย ย ย ย color: #d97706;
ย ย ย ย }

ย ย ย ย .status-confirmed,
ย ย ย ย .status-Completed {
ย ย ย ย ย ย background-color: #f0fdf4;
ย ย ย ย ย ย color: #16a34a;
ย ย ย ย }

ย ย ย ย .status-rejected,
ย ย ย ย .status-Cancelled {
ย ย ย ย ย ย background-color: #fef2f2;
ย ย ย ย ย ย color: #dc2626;
ย ย ย ย }

ย ย ย ย /* Action Buttons */
ย ย ย ย .btn-action {
ย ย ย ย ย ย padding: 0.3rem 0.6rem;
ย ย ย ย ย ย font-size: 0.8rem;
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย transition: all 0.2s ease;
ย ย ย ย }

ย ย ย ย .btn-approve {
ย ย ย ย ย ย background-color: #16a34a;
ย ย ย ย ย ย color: white;
ย ย ย ย }

ย ย ย ย .btn-approve:hover {
ย ย ย ย ย ย background-color: #15803d;
ย ย ย ย }

ย ย ย ย .btn-reject {
ย ย ย ย ย ย background-color: #dc2626;
ย ย ย ย ย ย color: white;
ย ย ย ย }

ย ย ย ย .btn-reject:hover {
ย ย ย ย ย ย background-color: #b91c1c;
ย ย ย ย }

ย ย ย ย /* Table Style */
ย ย ย ย tbody tr {
ย ย ย ย ย ย transition: background-color 0.2s ease;
ย ย ย ย }

ย ย ย ย tbody tr:hover {
ย ย ย ย ย ย background-color: #ffffff;
ย ย ย ย }

ย ย ย ย tbody td,
ย ย ย ย thead th {
ย ย ย ย ย ย padding: 1rem 1.5rem;
ย ย ย ย ย ย border-bottom: 1px solid #e5e7eb;
ย ย ย ย ย ย text-align: left;
ย ย ย ย }

ย ย ย ย /* Ensure left align */
ย ย ย ย .form-input {
ย ย ย ย ย ย margin-top: 0.25rem;
ย ย ย ย ย ย display: block;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย border: 1px solid #d1d5db;
ย ย ย ย ย ย border-radius: 0.375rem;
ย ย ย ย ย ย box-shadow: sm;
ย ย ย ย ย ย padding: 0.5rem;
ย ย ย ย }

ย ย ย ย .form-input:focus {
ย ย ย ย ย ย border-color: var(--brand-navy);
ย ย ย ย ย ย box-shadow: 0 0 0 2px rgba(27, 42, 73, 0.3);
ย ย ย ย ย ย outline: none;
ย ย ย ย }
ย ย </style>
</head>

<body class="bg-gray-100">

ย ย <header class="bg-white shadow-md">
ย ย ย ย <div class="container mx-auto px-6 py-4 flex justify-between items-center">
ย ย ย ย ย ย <h1 class="text-3xl font-bold" style="color: var(--brand-navy);">
ย ย ย ย ย ย ย ย CitySetu <span class="font-light">Admin Dashboard</span>
ย ย ย ย ย ย </h1>
ย ย ย ย ย ย <button onclick="admin.fetchData()" id="refresh-btn"
ย ย ย ย ย ย ย ย class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-all">
ย ย ย ย ย ย ย ย ๐ Refresh Data
ย ย ย ย ย ย </button>
ย ย ย ย </div>
ย ย </header>

ย ย <main class="container mx-auto px-6 py-8">
ย ย ย ย <div class="bg-white rounded-lg shadow-sm">
ย ย ย ย ย ย <nav class="flex border-b border-gray-200">
ย ย ย ย ย ย ย ย <button id="tab-chats" class="tab-btn active" onclick="admin.showTab('chats')">
ย ย ย ย ย ย ย ย ย ย Chat Bookings (<span id="chat-count">0</span>)
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย <button id="tab-calls" class="tab-btn" onclick="admin.showTab('calls')">
ย ย ย ย ย ย ย ย ย ย Call Logs (<span id="call-count">0</span>)
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย <button id="tab-workers" class="tab-btn" onclick="admin.showTab('workers')">
ย ย ย ย ย ย ย ย ย ย Manage Workers (<span id="worker-count">0</span>)
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย<button id="tab-signups" class="tab-btn" onclick="admin.showTab('signups')">
ย ย ย ย ย ย ย ย ย ย Worker Signups (<span id="signup-count">0</span>)
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </nav>
ย ย ย ย </div>

ย ย ย ย <div id="table-chats" class="table-wrapper active mt-6 bg-white rounded-lg shadow-md overflow-hidden">
ย ย ย ย ย ย <table class="w-full">
ย ย ย ย ย ย ย ย <thead class="bg-gray-50">
ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Timestamp</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Booking ID</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Name</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Phone</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Service</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Assigned Worker</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Status</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Action</th>
ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย <tbody id="chats-table-body" class="divide-y divide-gray-200">
ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย <td colspan="8" class="p-6 text-center text-gray-500" id="chats-loading">Loading data...</td>
ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย ย ย </table>
ย ย ย ย </div>

ย ย ย ย <div id="table-calls" class="table-wrapper mt-6 bg-white rounded-lg shadow-md overflow-hidden">
ย ย ย ย ย ย <table class="w-full">
ย ย ย ย ย ย ย ย <thead class="bg-gray-50">
ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Timestamp
ย ย ย ย ย ย ย ย ย ย ย ย </th>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Worker
ย ย ย ย ย ย ย ย ย ย ย ย ย ย Name</th>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Customer Phone
ย ย ย ย ย ย ย ย ย ย ย ย </th>
ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย <tbody id="calls-table-body" class="divide-y divide-gray-200">
ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย <td colspan="3" class="p-6 text-center text-gray-500" id="calls-loading">Loading data...</td>
ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย ย ย </table>
ย ย ย ย </div>

ย ย ย ย <div id="table-signups" class="table-wrapper mt-6 bg-white rounded-lg shadow-md overflow-hidden">
ย ย ย ย ย ย <table class="w-full">
ย ย ย ย ย ย ย ย <thead class="bg-gray-50">
ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Timestamp</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Name</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Phone</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Service</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">City</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Address</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Status</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย<th class="p-6 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Action</th>
ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย <tbody id="signups-table-body" class="divide-y divide-gray-200">
ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย <td colspan="8" class="p-6 text-center text-gray-500" id="signups-loading">Loading data...</td>
ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย ย ย </table>
ย ย ย ย </div>


ย ย ย ย <div id="section-workers" class="section-wrapper mt-6 space-y-6">

ย ย ย ย ย ย <div class="bg-white p-6 rounded-lg shadow-md">
ย ย ย ย ย ย ย ย <h2 class="text-xl font-semibold mb-4" style="color: var(--brand-navy);">Add New Worker</h2>
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <form id="add-worker-form" class="grid grid-cols-1 md:grid-cols-3 gap-4">
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="worker-name" class="block text-sm font-medium text-gray-700">Name*</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="worker-name" required class="form-input">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="worker-service" class="block text-sm font-medium text-gray-700">Service*</label>
ย ย ย ย ย ย ย ย ย ย ย ย <select id="worker-service" class="form-input" required>
ย ย <option value="" disabled selected>Select a Service</option>
ย ย <option value="AC Repair">โ๏ธ AC Repair</option>
ย ย <option value="Laptop Repair">๐ป Laptop Repair</option>
ย ย <option value="Electrician">๐ก Electrician</option>
ย ย <option value="Home Repair">๐จ Home Repair</option>
ย ย <option value="Cleaning">๐งน Home Cleaning</option>
ย ย <option value="Plumber">๐ง Plumber</option>
ย ย </select>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="worker-phone" class="block text-sm font-medium text-gray-700">Phone (Required)*</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="tel" id="worker-phone" required placeholder="e.g., 9876543210" class="form-input">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="worker-city" class="block text-sm font-medium text-gray-700">City</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="worker-city" placeholder="e.g., Ahmedabad" class="form-input">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="worker-pincode" class="block text-sm font-medium text-gray-700">Pincode</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="worker-pincode" placeholder="e.g., 380061"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="form-input">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="worker-status" class="block text-sm font-medium text-gray-700">Status</label>
ย ย ย ย ย ย ย ย ย ย ย ย <select id="worker-status" class="form-input">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="available" selected>Available</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="busy">Busy</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="inactive">Inactive</option>
ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="md:col-span-3 text-right">
ย ย ย ย ย ย ย ย ย ย ย ย <button type="submit" id="add-worker-btn"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="bg-green-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-green-700 transition-colors">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย + Add Worker
ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </form>
ย ย ย ย ย ย ย ย <div id="worker-form-message" class="mt-4 text-sm font-medium hidden"></div>
ย ย ย ย ย ย </div>


ย ย ย ย ย ย <div class="bg-white rounded-lg shadow-md overflow-hidden">
ย ย ย ย ย ย ย ย <h2 class="text-xl font-semibold p-6 border-b" style="color: var(--brand-navy);">Existing Workers</h2>
ย ย ย ย ย ย ย ย <div class="overflow-x-auto">
ย ย ย ย ย ย ย ย ย ย <table class="w-full min-w-max">
ย ย ย ย ย ย ย ย ย ย ย ย <thead class="bg-gray-50">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th class="p-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ID</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th class="p-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Name</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th class="p-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Phone</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th class="p-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Service</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th class="p-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย City</th> <th class="p-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Status</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย ย ย ย ย <tbody id="workers-table-body" class="divide-y divide-gray-200">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td colspan="6" class="p-6 text-center text-gray-500" id="workers-loading">Loading
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย workers...</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย ย ย ย ย ย ย </table>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </main>

ย ย <script>
ย ย ย ย // ------------------------------------------------------------------
ย ย ย ย // CONFIGURATION & AUTHENTICATION
ย ย ย ย // ------------------------------------------------------------------
ย ย ย ยย
ย ย ย ย // This is your live Render API URL
ย ย ย ย const RENDER_API_URL = 'https://citysetu-api.onrender.com';

ย ย ย ย // Get the token from sessionStorage (which admin-login.html should save)
ย ย ย ย const ADMIN_TOKEN = sessionStorage.getItem('citysetu_admin_token');

ย ย ย ย // --- Password Protection Check ---
ย ย ย ย if (!ADMIN_TOKEN) {
ย ย ย ย ย ย alert('Admin token not found. Please log in.');
ย ย ย ย ย ย window.location.href = 'admin-login.html';
ย ย ย ย }
ย ย ย ย // --- End Protection Check ---


ย ย ย ย // ------------------------------------------------------------------
ย ย ย ย // ADMIN DASHBOARD LOGIC (Updated for Render API)
ย ย ย ย // ------------------------------------------------------------------
ย ย ย ย const admin = {
ย ย ย ย ย ย elements: {
ย ย ย ย ย ย ย ย // Tabs
ย ย ย ย ย ย ย ย chatTab: document.getElementById('tab-chats'),
ย ย ย ย ย ย ย ย callTab: document.getElementById('tab-calls'),
ย ย ย ย ย ย ย ย workerTab: document.getElementById('tab-workers'),
ย ย ย ย ย ย ย ย signupTab: document.getElementById('tab-signups'),

ย ย ย ย ย ย ย ย // Sections
ย ย ย ย ย ย ย ย chatTable: document.getElementById('table-chats'),
ย ย ย ย ย ย ย ย callTable: document.getElementById('table-calls'),
ย ย ย ย ย ย ย ย workerSection: document.getElementById('section-workers'),
ย ย ย ย ย ย ย ย signupTable: document.getElementById('table-signups'),
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Table Bodies
ย ย ย ย ย ย ย ย chatTableBody: document.getElementById('chats-table-body'),
ย ย ย ย ย ย ย ย callTableBody: document.getElementById('calls-table-body'),
ย ย ย ย ย ย ย ย workerTableBody: document.getElementById('workers-table-body'),
ย ย ย ย ย ย ย ย signupTableBody: document.getElementById('signups-table-body'),
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Loading Indicators
ย ย ย ย ย ย ย ย chatLoading: document.getElementById('chats-loading'),
ย ย ย ย ย ย ย ย callLoading: document.getElementById('calls-loading'),
ย ย ย ย ย ย ย ย workerLoading: document.getElementById('workers-loading'),
ย ย ย ย ย ย ย ย signupLoading: document.getElementById('signups-loading'),

ย ย ย ย ย ย ย ย // Counts
ย ย ย ย ย ย ย ย chatCount: document.getElementById('chat-count'),
ย ย ย ย ย ย ย ย callCount: document.getElementById('call-count'),
ย ย ย ย ย ย ย ย workerCount: document.getElementById('worker-count'),
ย ย ย ย ย ย ย ย signupCount: document.getElementById('signup-count'),

ย ย ย ย ย ย ย ย refreshBtn: document.getElementById('refresh-btn'),

ย ย ย ย ย ย ย ย // Worker Form
ย ย ย ย ย ย ย ย addWorkerForm: document.getElementById('add-worker-form'),
ย ย ย ย ย ย ย ย addWorkerBtn: document.getElementById('add-worker-btn'),
ย ย ย ย ย ย ย ย workerFormMessage: document.getElementById('worker-form-message')
ย ย ย ย ย ย },

ย ย ย ย ย ย init() {
ย ย ย ย ย ย ย ย this.elements.addWorkerForm.addEventListener('submit', this.handleAddWorker.bind(this));
ย ย ย ย ย ย ย ย this.fetchData();
ย ย ย ย ย ย },

ย ย ย ย ย ย showTab(tabName) {
ย ย ย ย ย ย ย ย // Hide all tabs and sections
ย ย ย ย ย ย ย ย [this.elements.chatTab, this.elements.callTab, this.elements.workerTab, this.elements.signupTab].forEach(tab => tab.classList.remove('active'));
ย ย ย ย ย ย ย ย [this.elements.chatTable, this.elements.callTable, this.elements.workerSection, this.elements.signupTable].forEach(sec => {
ย ย ย ย ย ย ย ย ย ย sec.classList.remove('active');
ย ย ย ย ย ย ย ย ย ย sec.style.display = 'none'; // Use style.display to hide
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย // Show the active one
ย ย ย ย ย ย ย ย if (tabName === 'chats') {
ย ย ย ย ย ย ย ย ย ย this.elements.chatTab.classList.add('active');
ย ย ย ย ย ย ย ย ย ย this.elements.chatTable.style.display = 'block';
ย ย ย ย ย ย ย ย ย ย this.elements.chatTable.classList.add('active');
ย ย ย ย ย ย ย ย } else if (tabName === 'calls') {
ย ย ย ย ย ย ย ย ย ย this.elements.callTab.classList.add('active');
ย ย ย ย ย ย ย ย ย ย this.elements.callTable.style.display = 'block';
ย ย ย ย ย ย ย ย ย ย this.elements.callTable.classList.add('active');
ย ย ย ย ย ย ย ย } else if (tabName === 'workers') {
ย ย ย ย ย ย ย ย ย ย this.elements.workerTab.classList.add('active');
ย ย ย ย ย ย ย ย ย ย this.elements.workerSection.style.display = 'block';
ย ย ย ย ย ย ย ย ย ย this.elements.workerSection.classList.add('active');
ย ย ย ย ย ย ย ย } else if (tabName === 'signups') {
ย ย ย ย ย ย ย ย ย ย this.elements.signupTab.classList.add('active');
ย ย ย ย ย ย ย ย ย ย this.elements.signupTable.style.display = 'block';
ย ย ย ย ย ย ย ย ย ย this.elements.signupTable.classList.add('active');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย },

ย ย ย ย ย ย async fetchData() {
ย ย ย ย ย ย ย ย this.elements.refreshBtn.disabled = true;
ย ย ย ย ย ย ย ย this.elements.refreshBtn.textContent = 'Refreshing...';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Show all loading messages
ย ย ย ย ย ย ย ย this.elements.chatLoading.parentElement.style.display = 'table-row';
ย ย ย ย ย ย ย ย this.elements.callLoading.parentElement.style.display = 'table-row';
ย ย ย ย ย ย ย ย this.elements.workerLoading.parentElement.style.display = 'table-row';
ย ย ย ย ย ย ย ย this.elements.signupLoading.parentElement.style.display = 'table-row';
ย ย ย ย ย ย ย ย this.elements.chatLoading.textContent = 'Loading data...';
ย ย ย ย ย ย ย ย this.elements.callLoading.textContent = 'Loading data...';
ย ย ย ย ย ย ย ย this.elements.workerLoading.textContent = 'Loading workers...';
ย ย ย ย ย ย ย ย this.elements.signupLoading.textContent = 'Loading signups...';

ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย // ### UPDATED FETCH CALL ###
ย ย ย ย ย ย ย ย ย ย // Fetch all data from the new admin endpoint
ย ย ย ย ย ย ย ย ย ย const response = await fetch(`${RENDER_API_URL}/api/admin/data`, {
ย ย ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${ADMIN_TOKEN}`
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (!response.ok) throw new Error(`Network error: ${response.status} ${response.statusText}`);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const data = await response.json();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (data.message) throw new Error(`API Error: ${data.message}`);

ย ย ย ย ย ย ย ย ย ย // Render all tables with the new data
ย ย ย ย ย ย ย ย ย ย this.renderChatTable(data.chats || []);
ย ย ย ย ย ย ย ย ย ย this.renderCallTable(data.calls || []);
ย ย ย ย ย ย ย ย ย ย this.renderWorkerTable(data.workers || []);
ย ย ย ย ย ย ย ย ย ย this.renderSignupTable(data.signups || []); // Render new table

ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('Failed to fetch data:', error);
ย ย ย ย ย ย ย ย ย ย // Update all loading messages on error
ย ย ย ย ย ย ย ย ย ย const errorMsg = `Error: ${error.message}`;
ย ย ย ย ย ย ย ย ย ย this.elements.chatLoading.textContent = errorMsg;
ย ย ย ย ย ย ย ย ย ย this.elements.callLoading.textContent = errorMsg;
ย ย ย ย ย ย ย ย ย ย this.elements.workerLoading.textContent = errorMsg;
ย ย ย ย ย ย ย ย ย ย this.elements.signupLoading.textContent = errorMsg;
ย ย ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย ย ย this.elements.refreshBtn.disabled = false;
ย ย ย ย ย ย ย ย ย ย this.elements.refreshBtn.textContent = '๐ Refresh Data';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย },

ย ย ย ย ย ย renderChatTable(chats) {
ย ย ย ย ย ย ย ย this.elements.chatTableBody.innerHTML = ''; // Clear only body
ย ย ย ย ย ย ย ย this.elements.chatCount.textContent = chats.length;

ย ย ย ย ย ย ย ย if (chats.length === 0) {
ย ย ย ย ย ย ย ย ย ย this.elements.chatTableBody.innerHTML = '<tr><td colspan="8" class="p-6 text-center text-gray-500">No chat bookings found.</td></tr>';
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย chats.forEach(chat => { // No reverse, server sends in DESC order
ย ย ย ย ย ย ย ย ย ย const tr = document.createElement('tr');
ย ย ย ย ย ย ย ย ย ย tr.setAttribute('data-id', chat.id);
ย ย ย ย ย ย ย ย ย ย const timestamp = new Date(chat.timestamp).toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' });
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Use a class-friendly status
ย ย ย ย ย ย ย ย ย ย const statusClass = `status-${String(chat.status).replace(' ', '-')}`;

ย ย ย ย ย ย ย ย ย ย tr.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย <td>${timestamp}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td class="font-mono text-xs">${chat.id}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${chat.customername}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${chat.customerphone}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td class="font-medium text-gray-900">${chat.service}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${chat.workerassigned || 'N/A'}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td><span class="status-badge ${statusClass}" id="status-${chat.id}">${chat.status}</span></td>
ย ย ย ย ย ย ย ย ย ย ย ย <td class="space-x-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="btn-action btn-approve" onclick="admin.updateStatus('${chat.id}', 'Completed')">Complete</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="btn-action btn-reject" onclick="admin.updateStatus('${chat.id}', 'Cancelled')">Cancel</button>
ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ย this.elements.chatTableBody.appendChild(tr);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย },

ย ย ย ย ย ย renderCallTable(calls) {
ย ย ย ย ย ย ย ย this.elements.callTableBody.innerHTML = '';
ย ย ย ย ย ย ย ย this.elements.callCount.textContent = calls.length;

ย ย ย ย ย ย ย ย if (calls.length === 0) {
ย ย ย ย ย ย ย ย ย ย this.elements.callTableBody.innerHTML = '<tr><td colspan="3" class="p-6 text-center text-gray-500">No call logs found.</td></tr>';
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย calls.forEach(call => { // No reverse, server sends in DESC order
ย ย ย ย ย ย ย ย ย ย const tr = document.createElement('tr');
ย ย ย ย ย ย ย ย ย ย const timestamp = new Date(call.timestamp).toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' });

ย ย ย ย ย ย ย ย ย ย tr.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย <td>${timestamp}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td class="font-medium text-gray-900">${call.workername}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${call.customerphone}</td>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ย this.elements.callTableBody.appendChild(tr);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย },
ย ย ย ย ย ยย
ย ย ย ย ย ย renderSignupTable(signups) {
ย ย ย ย ย ย ย ย this.elements.signupTableBody.innerHTML = '';
ย ย ย ย ย ย ย ย this.elements.signupCount.textContent = signups.length;

ย ย ย ย ย ย ย ย if (signups.length === 0) {
ย ย ย ย ย ย ย ย ย ย this.elements.signupTableBody.innerHTML = '<tr><td colspan="8" class="p-6 text-center text-gray-500">No new signups.</td></tr>';
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย signups.forEach(signup => {
ย ย ย ย ย ย ย ย ย ย const tr = document.createElement('tr');
ย ย ย ย ย ย ย ย ย ย const timestamp = new Date(signup.timestamp).toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' });
ย ย ย ย ย ย ย ย ย ย const statusClass = `status-${String(signup.status).replace(' ', '-')}`;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย tr.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย <td>${timestamp}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td class="font-medium text-gray-900">${signup.name}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${signup.phone}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${signup.service}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${signup.city}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td class="text-xs">${signup.address || 'N/A'}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td><span class="status-badge ${statusClass}">${signup.status}</span></td>
ย ย ย ย ย ย ย ย ย ย ย ย <td class="space-x-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="btn-action btn-approve" onclick="admin.approveSignup(this, '${signup.id}')">Approve</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ย this.elements.signupTableBody.appendChild(tr);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย },

ย ย ย ย ย ย renderWorkerTable(workers) {
ย ย ย ย ย ย ย ย this.elements.workerTableBody.innerHTML = '';
ย ย ย ย ย ย ย ย this.elements.workerCount.textContent = workers.length;

ย ย ย ย ย ย ย ย if (workers.length === 0) {
ย ย ย ย ย ย ย ย ย ย this.elements.workerTableBody.innerHTML = '<tr><td colspan="6" class="p-6 text-center text-gray-500">No workers added yet.</td></tr>';
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย workers.forEach(worker => { // No reverse, server sends in DESC order
ย ย ย ย ย ย ย ย ย ย const tr = document.createElement('tr');
ย ย ย ย ย ย ย ย ย ย tr.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย <td class="font-mono text-xs">${worker.id}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td class="font-medium text-gray-900">${worker.name}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${worker.phone}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${worker.service}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${worker.city || 'N/A'}</td>ย
ย ย ย ย ย ย ย ย ย ย ย ย <td>${worker.status}</td>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ย this.elements.workerTableBody.appendChild(tr);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย },

ย ย ย ย ย ย async handleAddWorker(event) {
ย ย ย ย ย ย ย ย event.preventDefault();
ย ย ย ย ย ย ย ย this.elements.addWorkerBtn.disabled = true;
ย ย ย ย ย ย ย ย this.elements.addWorkerBtn.textContent = 'Adding...';
ย ย ย ย ย ย ย ย this.elements.workerFormMessage.classList.add('hidden');

ย ย ย ย ย ย ย ย // ### UPDATED DATA OBJECT ###
ย ย ย ย ย ย ย ย // Matches the new database schema
ย ย ย ย ย ย ย ย const workerData = {
ย ย ย ย ย ย ย ย ย ย name: document.getElementById('worker-name').value.trim(),
ย ย ย ย ย ย ย ย ย ย service: document.getElementById('worker-service').value.trim(),
ย ย ย ย ย ย ย ย ย ย phone: document.getElementById('worker-phone').value.trim(),
ย ย ย ย ย ย ย ย ย ย city: document.getElementById('worker-city').value.trim(),
ย ย ย ย ย ย ย ย ย ย pincode: document.getElementById('worker-pincode').value.trim(),
ย ย ย ย ย ย ย ย ย ย status: document.getElementById('worker-status').value
ย ย ย ย ย ย ย ย };

ย ย ย ย ย ย ย ย // Updated validation
ย ย ย ย ย ย ย ย if (!workerData.name || !workerData.service || !workerData.phone) {
ย ย ย ย ย ย ย ย ย ย this.showWorkerFormMessage('Name, Service, and Phone are required.', 'red');
ย ย ย ย ย ย ย ย ย ย this.elements.addWorkerBtn.disabled = false;
ย ย ย ย ย ย ย ย ย ย this.elements.addWorkerBtn.textContent = '+ Add Worker';
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย // ### UPDATED FETCH CALL ###
ย ย ย ย ย ย ย ย ย ย // Posts to the new /api/workers endpoint
ย ย ย ย ย ย ย ย ย ย const response = await fetch(`${RENDER_API_URL}/api/workers`, {
ย ย ย ย ย ย ย ย ย ย ย ย method: 'POST',
ย ย ย ย ย ย ย ย ย ย ย ย headers: {ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย "Content-Type": "application/json",
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${ADMIN_TOKEN}`
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย body: JSON.stringify(workerData)
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const result = await response.json();

ย ย ย ย ย ย ย ย ย ย if (response.ok && result.status === 'success') {
ย ย ย ย ย ย ย ย ย ย ย ย this.showWorkerFormMessage(result.message || 'Worker added!', 'green');
ย ย ย ย ย ย ย ย ย ย ย ย this.elements.addWorkerForm.reset();
ย ย ย ย ย ย ย ย ย ย ย ย this.fetchData(); // Refresh list
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย throw new Error(result.message || 'Unknown error adding worker.');
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('Error adding worker:', error);
ย ย ย ย ย ย ย ย ย ย this.showWorkerFormMessage(`Error: ${error.message}`, 'red');
ย ย ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย ย ย this.elements.addWorkerBtn.disabled = false;
ย ย ย ย ย ย ย ย ย ย this.elements.addWorkerBtn.textContent = '+ Add Worker';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย },

ย ย ย ย ย ย showWorkerFormMessage(message, color = 'green') {
ย ย ย ย ย ย ย ย this.elements.workerFormMessage.textContent = message;
ย ย ย ย ย ย ย ย this.elements.workerFormMessage.style.color = color;
ย ย ย ย ย ย ย ย this.elements.workerFormMessage.classList.remove('hidden');
ย ย ย ย ย ย },

ย ย ย ย ย ย async updateStatus(id, newStatus) {
ย ย ย ย ย ย ย ย console.log(`Updating ${id} to ${newStatus}`);
ย ย ย ย ย ย ย ย const statusBadge = document.getElementById(`status-${id}`);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Optimistic UI update
ย ย ย ย ย ย ย ย if (statusBadge) {
ย ย ย ย ย ย ย ย ย ย statusBadge.textContent = newStatus;
ย ย ย ย ย ย ย ย ย ย statusBadge.className = `status-badge status-${newStatus.replace(' ', '-')}`;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย // ### UPDATED FETCH CALL ###
ย ย ย ย ย ย ย ย ย ย // Puts to the new /api/update-status/:id endpoint
ย ย ย ย ย ย ย ย ย ย const response = await fetch(`${RENDER_API_URL}/api/update-status/${id}`, {
ย ย ย ย ย ย ย ย ย ย ย ย method: 'PUT',
ย ย ย ย ย ย ย ย ย ย ย ย headers: {ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย "Content-Type": "application/json",
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${ADMIN_TOKEN}`
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย body: JSON.stringify({ newStatus: newStatus }) // Server expects newStatus
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const result = await response.json();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (!response.ok || result.status !== 'success') {
ย ย ย ย ย ย ย ย ย ย ย ย throw new Error(result.message || 'Failed to update');
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย console.log('Status updated in DB');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.error('Failed to update status in DB:', error);
ย ย ย ย ย ย ย ย ย ย if (statusBadge) {
ย ย ย ย ย ย ย ย ย ย ย ย ย// Revert on error
ย ย ย ย ย ย ย ย ย ย ย ย statusBadge.textContent = 'Pending';
ย ย ย ย ย ย ย ย ย ย ย ย statusBadge.className = 'status-badge status-Pending';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย alert('Error updating status: ' + error.message);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย },
ย ย ย ย ย ยย
ย ย ย ย ย ย // This function is new. It takes a signup, posts it to /api/workers,
ย ย ย ย ย ย // and then (on success) deletes the signup.
ย ย ย ย ย ย async approveSignup(button, signupId) {
ย ย ย ย ย ย ย ย button.disabled = true;
ย ย ย ย ย ย ย ย button.textContent = 'Approving...';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // 1. Find the signup data in our fetched list
ย ย ย ย ย ย ย ย const signup = (await admin.fetchDataForApproval()).find(s => s.id === signupId);
ย ย ย ย ย ย ย ย if (!signup) {
ย ย ย ย ย ย ย ย ย ย alert('Error: Could not find signup data.');
ย ย ย ย ย ย ย ย ย ย button.textContent = 'Approve';
ย ย ย ย ย ย ย ย ย ย button.disabled = false;
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย // 2. Create the new worker object
ย ย ย ย ย ย ย ย const workerData = {
ย ย ย ย ย ย ย ย ย ย name: signup.name,
ย ย ย ย ย ย ย ย ย ย phone: signup.phone,
ย ย ย ย ย ย ย ย ย ย service: signup.service,
ย ย ย ย ย ย ย ย ย ย city: signup.city,
ย ย ย ย ย ย ย ย ย ย pincode: signup.pincode,
ย ย ย ย ย ย ย ย ย ย status: 'available' // Default status
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย // 3. Post to /api/workers
ย ย ย ย ย ย ย ย ย ย const addWorkerResponse = await fetch(`${RENDER_API_URL}/api/workers`, {
ย ย ย ย ย ย ย ย ย ย ย ย method: 'POST',
ย ย ย ย ย ย ย ย ย ย ย ย headers: {ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย "Content-Type": "application/json",
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Authorization': `Bearer ${ADMIN_TOKEN}`
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย body: JSON.stringify(workerData)
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const addResult = await addWorkerResponse.json();
ย ย ย ย ย ย ย ย ย ย if (!addWorkerResponse.ok) {
ย ย ย ย ย ย ย ย ย ย ย ย throw new Error(`Add Worker Failed: ${addResult.message}`);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // 4. TODO: Delete the signup.
ย ย ย ย ย ย ย ย ย ย // Your server doesn't have a DELETE /api/signups/:id endpoint yet.
ย ย ย ย ย ย ย ย ย ย // For now, we'll just refresh the data.
ย ย ย ย ย ย ย ย ย ย console.log('Worker approved and added!');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // 5. Refresh all data
ย ย ย ย ย ย ย ย ย ย this.fetchData();

ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย alert(`Approval Error: ${error.message}`);
ย ย ย ย ย ย ย ย ย ย button.textContent = 'Approve';
ย ย ย ย ย ย ย ย ย ย button.disabled = false;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย },
ย ย ย ย ย ยย
ย ย ย ย ย ย // Helper to get raw signup data for approval
ย ย ย ย ย ย async fetchDataForApproval() {
ย ย ย ย ย ย ย ย ยconst response = await fetch(`${RENDER_API_URL}/api/admin/data`, {
ย ย ย ย ย ย ย ย ย ย headers: { 'Authorization': `Bearer ${ADMIN_TOKEN}` }
ย ย ย ย ย ย ย ย ย});
ย ย ย ย ย ย ย ย ยconst data = await response.json();
ย ย ย ย ย ย ย ย ยreturn data.signups || [];
ย ย ย ย ย ย }
ย ย ย ย };

ย ย ย ย document.addEventListener('DOMContentLoaded', () => admin.init());
ย ย </script>
</body>

</html>
